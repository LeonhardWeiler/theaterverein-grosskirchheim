import fs from 'fs';
import path from 'path';
import sharp from 'sharp';

const baseDir = './src/assets';

const sizes = [
  { suffix: '-big', width: 1200, quality: 80 },
  { suffix: '-medium', width: 700, quality: 80 },
  { suffix: '-small', width: 400, quality: 75 },
  { suffix: '-lq', width: 50, quality: 20 }
];

async function processImage(filePath) {
  const ext = path.extname(filePath);
  const base = filePath.replace(ext, '');

  for (const size of sizes) {
    const outFile = `${base}${size.suffix}${ext}`;

    try {
      await sharp(filePath)
        .resize({ width: size.width })
        .webp({ quality: size.quality })
        .toFile(outFile);

      console.log(`âœ… Created/Overwritten: ${outFile}`);
    } catch (err) {
      console.error(`âŒ Error processing ${filePath}:`, err);
    }
  }
}

function walkFolder(folder) {
  const items = fs.readdirSync(folder);

  items.forEach(item => {
    const fullPath = path.join(folder, item);
    const stat = fs.statSync(fullPath);

    if (stat.isDirectory()) {
      walkFolder(fullPath);
    } else if (stat.isFile() && fullPath.endsWith('.webp')) {
      processImage(fullPath);
    }
  });
}

console.log("ðŸš€ Starte Bildverarbeitung â€¦");
walkFolder(baseDir);
console.log("ðŸ¥³ Fertig!");

